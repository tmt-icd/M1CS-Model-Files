subsystem=M1CS
component=rtcHCD
description="""Commands accepted by the M1CS Real-Time Controller HCD"""
receive=[
  {
    name = UpdateElevation
    description = """
        A oneway command sent by M1CA to update the RTC with the telescope mount azimuth and elevation.
    """,
    completionType = oneway
    requiredArgs = [az, el, tai]
    role = user
    args = [
      {
        name = az
        type = double
        minimum = 0.0
        maximum = 360.0
        description = "The azimuth of the telescope mount at the TAI time. 0.0 >= az <= 360.0"
      },
      {
        name = el
        type = double
        minimum = 0.0
        maximum = 90.0
        description = "The elevation of the telescope mount at the TAI time. 0.0 >- el <= 90.0"
      }
      {
        name = tai
        type = taiTime
        units = tai
        description = "The time when the az/el are correct."
      }
    ]
  }

  {
    name = UpdateFocus
    description = """
        A oneway command sent by M1CA to update the RTC with a focus offload value.
    """,
    completionType = oneway
    requiredArgs = [focus, tai]
    role = user
    args = [
      {
        name = focus
        type = float
        description = "The focus offload calculated for M1CS at the TAI time."
      },
      {
        name = tai
        type = taiTime
        units = tai
        description = "The time when the focus value is correct."
      }
    ]
  }

  {
    name = UpdateWaveFrontError
    description = """
        A oneway command sent by M1CA to update the RTC with the current wavefront error as an array of Zernikes.
    """,
    completionType = oneway
    requiredArgs = [terms, numTerms, tai]
    role = user
    args = [
      {
        name = terms
        description = "Zernike coefficients for the wavefront error at the TAI time."
        type = array
        maxItems = 100
        units = micron
        items = {
          type = float
        }
      },
      {
        name = numTerms
        description = "The number of terms included in the terms array."
        type = integer
      }
      {
        name = tai
        type = taiTime
        units = tai
        description = "The time when the focus value is correct."
      }
    ]
  }

  {
    name = SET_OPMODE_IDLE
    description = """
        A oneway command sent by M1CA to update the M1CS operating mode. IDLE indicates RTC and M1CS can not move hardware. RTC takes actions required to ensure no motion takes place.
    """,
    completionType = oneway
    role = user
  }

  {
    name = SET_OPMODE_RUNNING
    description = """
        A oneway command sent by M1CA to update the M1CS operating mode. RUNNING indicates RTC and M1CS can move hardware. RTC takes actions required to ensure to allow motion to take place.
    """,
    completionType = oneway
    role = user
  }

  {
    name = SET_IDLE
    description = """
        A oneway command sent by M1CA to update the RTC mode. Control loops are open, no actuator commands are issued.
    """,
    completionType = oneway
    role = user
  }

  {
    name = SET_SLEW
    description = """
        A oneway command sent by M1CA to update the RTC when the TCS mount is in preset. Inner loop is closed, outer loop open.
    """
  }
  {
    name = SET_TRACK
    description = """
        A oneway command sent by M1CA to update the RTC when the TCS mount is tracking. Both inner and outer loop are closed. This is the normal mode during observing.
    """
    completionType = immediate
    role = user
  }

  {
    name = CLEAR_OUTER_LOOP_STATE
    description = """
        An immediate command sent by M1CA to clear the internal state information of the outer loop filter.

    """,
    completionType = oneway
    role = user
  }

  {
    name = CAPTURE_ACTUATOR_POSITIONS
    description = """
        A long running command sent by M1CA to cause sampling of the actuators for the specified amount of time in seconds. The results are written to the temporary file specified.
    """,
    completionType = longRunning
    role = user
    requiredArgs = [duration, outputFile]
    args = [
      {
        name = duration
        description = "The length of time RTC should average actuator positions."
        type = float
        units = second
      },
      {
        name = outputFile
        description = "The full path of the file that should be created and written to. If the file exists, the file should be overwritten."
        type = string
      }
    ]
  }

  {
    name = GET_SENSOR_VALUES
    description = """
        An immediate command sent by M1CA that returns the 2772 sensor heights and gaps.
        The RTC HCD caches the sensor values once per second.

        Array index 0 is sensor 1 on segment A1. Index 2771 is sensor 12 on segment F82. Note that not all segments have 6 sensor values. When no sensor is present, values are 0.
    """,
    completionType = immediate
    role = user
    resultType = [
      {
        name = heights
        description = "The 2772 sensor height values."
        type = array
        units = micron
        dimensions = [2772]
        items = {
          type = float
        }
      }
      {
        name = gaps
        description = "The 2772 sensor gap values."
        type = array
        units = micron
        dimensions = [2772]
        items = {
          type = float
        }
      }
    ]
  }

  {
    name = GET_OUTER_LOOP
    description = """
        An immediate command sent by M1CA that returns the current and demand outer loop piston, tipo, and tilt.
    """,
    completionType = immediate
    role = user
    resultType = [
      {
        name = currentPiston
        description = "The current outer loop piston value."
        type = float
        units = micron
      }
      {
        name = currentTip
        description = "The current outer loop tip value."
        type = float
        units = micron
      }
      {
        name = currentTilt
        description = "The current outer loop tilt value."
        type = float
        units = micron
      }
      {
        name = demandPiston
        description = "The demand outer loop piston value."
        type = float
        units = micron
      }
      {
        name = demandTip
        description = "The demand outer loop tip value."
        type = float
        units = micron
      }
      {
        name = demandTilt
        description = "The demand outer loop tilt value."
        type = float
        units = micron
      }
    ]
  }

  {
    name = GET_OUTER_LOOP_CONTROL
    description = """
        A long running command sent by M1CA that requests the most recent 24 outer loop output values as control commands in microns.
    """,
    completionType = longRunning
    role = user
    resultType = [
      {
        name = commands
        description = "The most recent 24 control commands."
        type = array
        units = micron
        dimensions = [24]
        items = {
          type = float
        }
      }
    ]
  }

  {
    name = GET_RTC_STATUS
    description = """
        An immediate command sent by M1CA that returns the high level RTC information cached by the RTC HCD.

    """,
    completionType = immediate
    role = user
    resultType = [
      {
        name = outerPiston
        description = "The outer loop piston value."
        type = float
        units = micron
      }
      {
        name = outerTip
        description = "The outer loop tip value."
        type = float
        units = micron
      }
      {
        name = outerTilt
        description = "The outer loop tilt value."
        type = float
        units = micron
      }
      {
        name = gaps
        description = "The 2772 sensor gap values."
        type = array
        units = micron
        dimensions = [2772]
        items = {
          type = float
        }
      }
    ]
  }
]

