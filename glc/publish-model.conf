subsystem = M1CS
component = GLC
publish {
  events = [
    # APS ICD events
    {
      name = M1Health
      description = """Per the Observatory Requirements Document subsystems are required to generate an overall
        health message once per second.  The M1CS Control Assembly generates an overall health event that should be
        sufficient to support normal Science Operations.
      """
      maxRate = 1
      archive = true
      parameters = [
        {
          name = m1csHealth
          description = "This is overall M1CS health."
          enum = [GOOD, ILL, BAD, INTERLOCKED, UNKNOWN]
        }
        {
          name = reason
          description = "Health message."
          type = string
        }
      ]
    }
    {
      name = M1RtcStatus
      description = """Status Information for the M1CS RTC loop."""
      maxRate = 1
      archive = true
      parameters = [
        {
          name = rtcLoopState
          description = "State of the internal control loop."
          enum = [HALTED, STANDBY, TRACK]
        }
        {
          name = rtcOuterLoopInputs
          description = "Inputs to outer loop."
          enum = [NONE, ALL, PTT, FOCUS, ZERNIKE]
        }
        {
          name = sensorHeightRms
          description = "The RMS across the mirror of the corrected sensor heights."
          type = double
        }
        {
          name = actuatorPositionRms
          description = "The RMS across the mirror of actuator target position errors."
          type = double
        }
      ]
    }

    {
      name = M1SegmentTemperatures
      description = """
      Temperature measured by the thermistors mounted on the upper segment attached to the segment warping harness cables.
      Each segment has 3 temperature probes.
    """
      #requireRate=0.1666666
      maxRate = 0.1666666
      archive = true
      parameters = [
        {
          name = temperatures
          description = "Temperatures reported by upper segment thermistors. With location [S, T], S is the segment starting at A1 at location 0. T is one of three segment temperatures."
          type = array
          dimensions = [492, 3]
          items = {
            type = float
          }
        }
      ]
    }

    {
      name = M1SegmentStatus
      description = """
      This event contains a description of the current mirror configuration. Information includes which segments are installed and active
      along with the segment electronic identifiers and names.
    """
      maxRate = 1
      archive = true
      parameters = [
        {
          name = status
          description = "The status of the M1 segments ordered by ascending mirror cell locatons [A-F][1-82]. Index 0 is A1."
          type = array
          items = {
            enum = [INSTALLED, ACTIVE, UNINSTALLED]
          }
        }
        {
          name = segmentId
          description = """
            Installed segment electronic IDs ordered by ascending mirror cell locatons [A-F][1-82].
            Index 0 is A1.
            """
          type = array
          dimensions = [492]
          items = {
            type = integer
          }
        }
        {
          name = segmentSerialNum
          description = """
            Serial number of the installed segments ordered by ascending mirror cell locatons [A-F][1-82].
            The integer value is the integer portion of SN-XXX.
          """
          type = array
          dimensions = [492]
          items = {
            type = integer
          }
        }
      ]
    }
    # END APS ICD Events

    {
      name: status,
      description: """
        This event provides high-level information for user interfaces and others interested in M1CS status.
      """,
      category: STATUS,
      maxRate: 0.1,
      archive: false,
      category: STATUS
      parameters: [
        {
          name: assemblyState,
          description: "The current M1CS Control Assembly state.",
          enum: ["READY", "FAULTED"]
        },
        {
          name: rtcHcdState
          description: "The current operational state of the RTC HCD, which is used to command and receive status from the M1CS RTC."
          enum: ["UNINITIALIZED", "READY", "FAULTED"]
        },
        {
          name: segmentHcdState
          description: "The current operational state of the segment HCD, which is used to communicate with the indidivual segments."
          enum: ["UNINITIALIZED", "READY", "FAULTED"]
        },
        {
          name: segmentStatus
          description: """
          The M1CS segment status is a 492 character string. Each character represents a segment at a mirror location and can be one of enum: [E, U, T, O]
          with U=Unavailable, T=Tracking, O=Out of range. Out of range indicates that the segment is currently not within required limits or is not operating.
          If a segment is not installed or removed from operation it is Unavailable Char 0 of the string is A1, char 491 is F82.
          """,
          type: "string"
        },
        {
          name: performanceQuality
          description: """
          Performance quality indicates if M1CS control is operating properly and meeting demands and overall performance.  Green indicates yes, red indicates there is an issue that requires attention.
          Note that control can be GREEN while something like the Purge Assembly or LAN Assembly is red.
          """,
          enum: ["GREEN", "RED"]
        },
        {
          name: innerLoopQuality
          description: "A high-level view of the inner loop performance and state. Green if all mean values are within specified performance limits."
          enum: ["GREEN", "RED"]
        }
        {
          name: outerLoopQuality
          description: "A high-level view of the outer loop performance and state. Green if all values are within specified performance limits."
          enum: ["GREEN", "RED"]
        }
        {
          name: actuatorQuality
          description: "A high-level view of the actuator performance and state. Green if all actuator metrics are within specified performance limits."
          enum: ["GREEN", "RED"]
        }
        {
          name: actuatorStatus
          description: """
            High level view of individual actuators. A string of length 1476. Each character can be R, G, D where R = Bad, G = Good, D = Disconnected.
            """
          type = string
        }
        {
          name: sensorQuality
          description: "A high-level view of the sensor performance. Green if all values are within specified performance limits. Red if one or more sensors are misbehaving."
          enum: ["GREEN", "RED"]
        }
        {
          name: sensorStatus
          description: """
            High level view of sensor pairs. A string of length 2772. Each character can be R, G, D where R = Bad, G = Good, D = Disconnected. Index values follow the normal naming of sensor pairs.
            """
          type = string
        }
      ]
    }

    {
      name: archiveState
      description: """
        This event provides information for M1CS long-term trend analysis that will be stored in the TIO Engineering Archive.
      """,
      category: STATUS
      maxRate: 0.1
      archive: true
      category: ARCHIVE
      parameters: [
        {
          name: performanceQuality,
          description: """
          Performance quality indicates if M1CS control is operating properly and meeting demands.  Green indicates yes, red indicates there is an issue that requires attention.
          Note that control can be GREEN while something like the Purge Assembly or LAN Assembly is red.
          """,
          enum: ["GREEN", "RED"]
        },
        {
          name: innerLoopLowOrderRMS
          description: """
            The square root of the mean square error (RMS) values for each of the first 10 control modes sampled for 1 second as published by RTC.
            """
          # saving:  $`\frac{1}{N}\sum_{i=0}^{i=N}(m_{i} - \overline{m_{i}})^2`$ where m is mode and N is the number of samples.
          type = array
          dimensions = [10]
          items = {
            type = float
          }
        },
        {
          name: innerLoopHighOrderRMS
          description: "A single value that is the square root of the average of the mean square error values of modes 11-1476 sampled for 1 second and published by the RTC"
          type = float
        },
        {
          name: outerLoopStatus
          description: "RTC reports the 1 second average of the outer loop Zernike input terms. This event includes averages for the first 10 terms."
          type = array
          dimensions = [10]
          items = {
            type = float
          }
        }
        {
          name: actuatorTEAverageSTD
          description: """
          The average tracking error standard deviation over all actuators = $`\sqrt{\frac{1}{A}\sum_{i=0}^{i=A}\sigma_i^2}`$
          where A is the number of actuators and variance $`\sigma_{i}^2 = \frac{1}{N}\sum_{i=0}^{i=N}(t_{i} - \mu_{i})^2`$
          where $`t_i`$ is the i'th actuator tracking error, $`\mu_i`$ is the i'th actuator's mean tracking error, and N is the number of samples used to calculate the variance.
          """
          type: float
        }
        {
          name: actuatorTEMedianAbsError
          description: """The median of the absolute value of the error over all actuators."""
          type: float
          units: micron
        }
        {
          name: actuatorTEMaxAbsError
          description: """The maximum of the absolute value of the error over all actuators."""
          type: float
          units: micron
        }
        {
          name: sensorAverageHeightNoise
          description: """The average of the height noise over all sensors."""
          type: float
          units: micron
        }
        {
          name: sensorMaxHeightNoise
          description: """The maximum of the height noise over all sensors."""
          type: float
          units: micron
        }
        {
          name: sensorAverageGapNoise
          description: """The average gap noise value over all sensors."""
          type: float
          units: micron
        }
        {
          name: sensorMaxGapNoise
          description: """The maximum gap noise value over all sensors."""
          type: float
          units: micron
        }
      ]
    }

    {
      name = M1ActuatorPositions
      description = """
	  Actuator positions measured in encoder units of microns.

	  This event is turned on with diagnostic mode hint "actuators".

	  See also command: GetActuatorPositions
	  """
      maxRate = 0.1
      archive = true
      category = ARCHIVE
      diagnosticModes = [actuators]
      diagnosticModeOnly = true
      parameters = [
        {
          name = positions
          description = "Actuator position as measured by the actuator encoders. With location [S, P], S is the segment starting at A1 at index 0. P is one of three segment actuator positions."
          type = array
          dimensions = [492, 3]
          items = {
            type = float
          }
          units = micron
        }
      ]
    }

    {
      name = M1SensorValues
      description = """
	  Sensor height and gap measurements M1CS calculates by monitoring sensors attached to the edges of each segment. *Note that not all segments have the same number of sensors!*

	  This event is turned on with diagnostic mode hint "sensors".

	  See also command: GetSensorValues
	"""
      maxRate = 0.1
      archive = true
      diagnosticModes = [sensors]
      diagnosticModeOnly = true
      category = ARCHIVE
      parameters = [
        {
          name = heights
          description = "Calculated edge sensor heights after correcting for gap."
          type = array
          units = micron
          dimensions = [2772]
          items = {
            type = float
          }
        }
        {
          name = gaps
          description = "Calculated edge sensor gaps from RTC."
          type = array
          units = micron
          dimensions = [2772]
          items = {
            type = float
          }
        }
      ]
    }

    {
      name = M1WarpingHarnessStrains
      description = """
	  Value of each warping harness strain gauge force.  Note max and min limits are in a configuration file.

	  This event is turned on with diagnostic mode hint "whstrains".

	  See also command: GetWarpingHarnessStrains
	  """
      maxRate = 0.1
      archive = true
      diagnosticModes = [whstrains]
      diagnosticModeOnly = true
      category = ARCHIVE
      parameters = [
        {
          name = strain
          description = "Current value of each of the 21 strain gauges attached to the 492 segments"
          type = array
          dimensions = [492, 21]
          items = {
            type = float
          }
          units = newton
        }
      ]
    }

    {
      name = M1PistonTipTilt
      description = """
        Current and target outer control loop piston, tip and tilt values.

        This event is turned on with diagnostic mode hint "pistontiptilt".

	      See also command: GetPistonTipTilt
      """
      maxRate = 0.1
      archive = true
      diagnosticModes = [pistontiptilt]
      diagnosticModeOnly = true
      category = ARCHIVE
      parameters = [
        {
          name = current
          description = "Current M1 Tip(0), Tilt(1), Piston(2)"
          type = array
          units = micron
          dimensions = [3]
          items = {
            type = float
          }
        }
        {
          name = target
          description = "M1 Tip(0), Tilt(1), Piston(2) target from the TCS elevation angle."
          type = array
          units = micron
          dimensions = [3]
          items = {
            type = float
          }
        }
      ]
    }

    {
      name = M1OuterLoopControlCommand
      description = """
        Outer control loop control commands.

        This event is turned on with diagnostic mode hint "M1OuterLoopControlCommand".

	      See also command: GetOuterLoopControlCommand
      """
      maxRate = 0.1
      archive = true
      diagnosticModes = [outerloop]
      diagnosticModeOnly = true
      category = ARCHIVE
      parameters = [
        {
          name = cmds
          description = "Calculated outer loop controller commands for 24 modes."
          type = array
          units = micron
          dimensions = [24]
          items = {
            type = float
          }
        }
      ]
    }
  ]
}
